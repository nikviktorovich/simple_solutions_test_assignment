{% extends 'base.html' %}

{% block head %}
<script src="https://js.stripe.com/v3/"></script>
{% endblock head %}

{% block title %}Item: {{ item.name }}{% endblock title %}

{% block content %}
<h2>{{ item.name }}</h2>
<p>{{ item.description }}</p>
<p>Price: {{ item.price }}</p>
<button id="button-buy">Buy</button>
{% endblock content %}

{% block bottom %}
<script>
    const stripe = Stripe("{{ stripe_publishable_api_key }}");
    const buttonBuy = document.querySelector("#button-buy");
    buttonBuy.addEventListener("click", () => {
        fetch("{% url 'payment_buy' item.pk %}")
            .then(response => response.json())
            .then(payment => stripe.redirectToCheckout({ sessionId: payment.session_id }))
            .then(result => console.info(result));
    });
</script>
{% endblock bottom %}
